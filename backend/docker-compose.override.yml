# Development override for docker-compose.yml
# This file is automatically used when running docker-compose up in development

services:
  # Development overrides for Virtual Garage API
  virtual-garage-api:
    environment:
      SPRING_PROFILES_ACTIVE: docker,dev
      JAVA_OPTS: >-
        -server
        -Xms256m
        -Xmx512m
        -XX:+UseG1GC
        -XX:MaxGCPauseMillis=100
        -XX:+UseStringDeduplication
        -Djava.awt.headless=true
        -Djava.security.egd=file:/dev/./urandom
        -Dspring.devtools.restart.enabled=true
        -Dspring.jpa.show-sql=true
        -Dlogging.level.com.virtualgarage=DEBUG
        -Dlogging.level.org.hibernate.SQL=DEBUG
        -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005
    ports:
      - "8080:8080"
      - "5005:5005"  # Debug port
    volumes:
      - app-logs:/app/logs
      - app-uploads:/app/uploads
      # Mount source for live reload (optional)
      - ./src:/workspace/src:ro
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 256M

  # PostgreSQL with development settings
  postgres:
    environment:
      POSTGRES_DB: virtual_garage
      POSTGRES_USER: virtual_garage
      POSTGRES_PASSWORD: garage123
      # Development specific settings
      POSTGRES_LOG_STATEMENT: all
      POSTGRES_LOG_MIN_DURATION_STATEMENT: 0
    command: >
      postgres
      -c shared_preload_libraries=pg_stat_statements
      -c max_connections=100
      -c shared_buffers=128MB
      -c effective_cache_size=512MB
      -c work_mem=2MB
      -c maintenance_work_mem=32MB
      -c log_statement=all
      -c log_min_duration_statement=0
      -c log_connections=on
      -c log_disconnections=on

  # Development tools (automatically included in dev mode)
  kafka-ui:
    profiles: []  # Remove debug profile requirement

  pgadmin:
    profiles: []  # Remove debug profile requirement